import numpy as np

def get_center_heatmap_sum_old(nonzero_count, k) -> float:
    """
    Count non-zero heatmap pixels in the center 4 columns (46â€“49) and map to [0,1]
    via an exponential shaping y = expm1(k*x)/expm1(k).
    k > 0: convex (suppresses small blobs), k < 0: concave, k ~ 0: ~linear.
    """

    # Normalize count to x in [0,1]
    x: float = float(nonzero_count) / 384.0


    # Numerically stable exponential mapping with linear fallback near k=0
    eps: float = 1e-6
    if abs(k) < eps:
        y = x
    else:
        y = np.expm1(k * x) / np.expm1(k)

    # (Optional) Clamp for safety
    if y < 0.0:
        y = 0.0
    elif y > 1.0:
        y = 1.0

    return float(y)/ 10


def get_center_heatmap_sum(nonzero_count, k) -> float:
    """
    Count non-zero heatmap pixels in the center 4 columns (46,47,48,49).
        
    Returns:
    float: Count of non-zero pixels (returned as float to keep downstream logic unchanged).
    """
    #fused_image = observation['image']          # [96, 96, 3], uint8 in [0, 255]
    #heatmap_channel = fused_image[:, :, 1]      # channel 1 is the heatmap
    #center_slice = heatmap_channel[:, 46:50]    # columns 46..49
    #nonzero_count = int(np.count_nonzero(center_slice))
    #for row in heatmap_channel:
    #    print(row)
    #print('count', nonzero_count)
    #exit()
    x = float(nonzero_count) / 384.0  # normalize to [0,1]
    k = 2.0  # 0.2~close to linear; 0.5~mildly convex; 2.0~convex; 3.0~exponential

    return float(np.expm1(k * x) / np.expm1(k))




print('non zero cout 380, k = 5', get_center_heatmap_sum(380, 5))
print('non zero cout 300, k = 5', get_center_heatmap_sum(300, 5))
print('non zero cout 250, k = 5', get_center_heatmap_sum(250, 5))
print('non zero cout 50, k = 5', get_center_heatmap_sum(50, 5))
print('')
print('non zero cout 380, k = 4', get_center_heatmap_sum(380, 4))
print('non zero cout 300, k = 4', get_center_heatmap_sum(300, 4))
print('non zero cout 250, k = 4', get_center_heatmap_sum(250, 4))
print('non zero cout 50, k = 4', get_center_heatmap_sum(50, 4))
print('')
print('non zero cout 380, k = 3', get_center_heatmap_sum(380, 3))
print('non zero cout 250, k = 3', get_center_heatmap_sum(250, 3))
print('non zero cout 50, k = 3', get_center_heatmap_sum(50, 3))
print('')
print('non zero cout 380, k = 2', get_center_heatmap_sum(380, 2))
print('non zero cout 250, k = 2', get_center_heatmap_sum(250, 2))
print('non zero cout 50, k = 2', get_center_heatmap_sum(50, 2))
print('')
print('non zero cout 380, k = 1', get_center_heatmap_sum(380, 1))
print('non zero cout 250, k = 1', get_center_heatmap_sum(250, 1))
print('non zero cout 50, k = 1', get_center_heatmap_sum(50, 1))
print('')
print('non zero cout 380, k = .5', get_center_heatmap_sum(380, 0.5))
print('non zero cout 250, k = .5', get_center_heatmap_sum(250, 0.5))
print('non zero cout 50, k = .5', get_center_heatmap_sum(50, 0.5))
print('')
print('non zero cout 380, k = .1', get_center_heatmap_sum(380, 0.1))
print('non zero cout 250, k = .1', get_center_heatmap_sum(250, 0.1))
print('non zero cout 50, k = .1', get_center_heatmap_sum(50, 0.1))

      
